library(dplyr)
# setwd("C:/Users/neo qi xiang/Desktop/sim_finance/project")
tesla = read.csv("TSLA.csv")
tesla_filter <- subset(tesla, select = c('Date', 'Adj.Close'))
tesla_filter$Date <- as.Date(tesla_filter$Date)
tesla_filter$year <- format(tesla_filter$Date, format = "%Y")
tesla_train <- tesla_filter %>% filter(year <= 2021)
#tesla_test <- tesla_filter %>% filter(year > 2020)
tesla_train$lag_year <- lag(tesla_train$Adj.Close,252)
tesla_train$returns <- tesla_train$Adj.Close/tesla_train$lag_year
tesla_train <- tesla_train %>% filter(!is.na(returns))
tesla_train$ln_returns <- log(tesla_train$returns)
v = mean(tesla_train$ln_returns)
sig_2<- var(tesla_train$ln_returns)
Binomtreefit<-function(v,sigma,Deltat,approx=TRUE){
if(approx){
p=1/2+v*sqrt(Deltat)/sigma/2
u=exp(sigma*sqrt(Deltat))
d=1/u
} else{
p=1/2+v*Deltat/(2*sqrt((v*Deltat)^2+sigma^2*Deltat))
u=exp(sqrt((v*Deltat)^2+sigma^2*Deltat))
d=1/u
}
list(p=p,u=u,d=d)
}
sigma=sqrt(sig_2)
dt=1
ApproxResult<-Binomtreefit(v,sigma,dt)
ApproxResult
sigma=sqrt(sig_2)
dt=1
NonApproxResult <- Binomtreefit(v,sigma,dt)
NonApproxResult
mu <- mean(tesla_train$returns)
sigma <- sqrt(var(tesla_train$returns))
s0 <- tail(tesla_train,1)$Adj.Close
s0
mu
sigma
Visualize<-function(S){
# endindex=ncol(S)
minS=min(S);maxS=max(S) # the y-limits of the plot
noS<-nrow(S)
cl<-rainbow(noS) # vector of rainbow colors
plot(S[1,],type="l",ylim=c(minS,maxS),col=cl[1])
if(noS>1){
for(i in 2:noS){
lines(S[i,],col=cl[i])
}
}
}
S0=s0; sigma=0.4; T=1; dt=1/252;
v=mu-sigma^2/2
set.seed(4518)
SimGBM<-SimGBMsde(100,S0,v,sigma,dt,T)
SimGBMsde<-function(Nsim,S0,mu,sigma,Deltat,T){
m=T/Deltat # number of periods
S=matrix(S0,nrow=Nsim,ncol=m+1)
for(i in 1:Nsim){
Z<-rnorm(m)
for(j in 2:(m+1)){
S[i,j]=S[i,j-1]+S[i,j-1]*(mu*Deltat+sigma*sqrt(Deltat)*Z[j-1])
}
}
S
}
tesla_prices<-as.numeric(as.vector(tesla_train$Adj.Close))
tesla_prices<-tesla_prices[!is.na(tesla_prices)]
n0=length(tesla_prices)
St=tesla_prices[n0]
sim_tesla<-SimGBMsde(100,St,v,sigma,dt,1)
Histdata<-matrix(rep(tesla_prices,100),ncol=n0,byrow=T)
wholedata<-cbind(Histdata,sim_tesla)
Visualize(wholedata)
wholedata
